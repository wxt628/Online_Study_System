# 校园综合平台数据库设计说明
## 一、数据库概述
### 1. 数据库基本信息
| 项目 | 内容 |
| ---- | ---- |
| 数据库名称 | `campus_platform` |
| 字符集 | `utf8mb4` |
| 排序规则 | `utf8mb4_unicode_ci` |
| 存储引擎 | `InnoDB`（支持事务、外键约束，保证数据一致性） |
| 设计用途 | 支撑校园综合平台的用户管理、小程序入口、课程作业、校园论坛、通知消息等核心业务 |

### 2. 设计原则
1.  数据完整性：通过主键、外键、唯一约束、非空约束保证数据有效性；
2.  可扩展性：表结构预留扩展字段（如`avatar_url`、`description`），适配后续业务迭代；
3.  性能优化：针对高频查询字段建立索引，提升查询效率；
4.  安全性：密码采用加密存储（表结构预留加密字段长度`255`），避免明文泄露。

## 二、表结构详细说明
### 1. 用户表（`users`）
#### 功能描述
存储平台所有用户的基础信息，作为其他业务表的关联核心（如作业提交、发帖、评论等）。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `user_id` | `INT` | 主键、自增 | 唯一标识用户，作为外键关联其他表 |
| `student_id` | `VARCHAR(20)` | 唯一、非空 | 用户学号，作为登录标识之一 |
| `password_hash` | `VARCHAR(255)` | 非空 | 加密后的用户密码（建议使用MD5、BCrypt等加密方式） |
| `failed_attempts` |   |   |  |
| `locked_until` |   |   |  |
| `name` | `VARCHAR(50)` | 非空 | 用户真实姓名 |
| `email` | `VARCHAR(100)` | 唯一 | 用户邮箱，用于找回密码、接收通知 |
| `phone` | `VARCHAR(20)` | 无 | 用户手机号 |
| `avatar_url` | `VARCHAR(255)` | 无 | 用户头像存储链接（支持本地存储或云存储） |
| `created_at` | `DATETIME` | 默认当前时间 | 用户账号创建时间 |
| `updated_at` | `DATETIME` | 默认当前时间、更新时自动刷新 | 用户信息最后修改时间 |

#### 索引说明
- `idx_student_id`：针对学号建立索引，优化学号登录/查询效率；
- `idx_email`：针对邮箱建立索引，优化邮箱相关查询（如找回密码）。

### 2. 小程序表（`mini_programs`）
#### 功能描述
存储校园平台内嵌的各类小程序入口信息，实现平台功能聚合。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `program_id` | `INT` | 主键、自增 | 小程序唯一ID |
| `name` | `VARCHAR(100)` | 非空 | 小程序名称（如“校园一卡通”、“图书馆查询”） |
| `icon_url` | `VARCHAR(255)` | 无 | 小程序图标链接 |
| `description` | `TEXT` | 无 | 小程序功能描述 |
| `url` | `VARCHAR(255)` | 非空 | 小程序跳转链接或前端路由地址 |
| `category` | `VARCHAR(50)` | 默认“其他” | 小程序分类（如“教务”、“生活”、“工具”） |
| `is_active` | `BOOLEAN` | 默认`TRUE` | 是否启用（`TRUE`启用，`FALSE`隐藏） |
| `display_order` | `INT` | 默认`0` | 显示排序（数值越小，展示越靠前） |
| `created_at` | `DATETIME` | 默认当前时间 | 小程序创建时间 |

#### 索引说明
- `idx_category`：针对分类建立索引，优化按分类筛选小程序的效率；
- `idx_is_active`：针对启用状态建立索引，优化查询可用小程序的效率。

### 3. 课程表（`courses`）
#### 功能描述
存储学生修读课程的基础信息，作为作业管理的关联核心。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `course_id` | `INT` | 主键、自增 | 课程唯一ID |
| `course_code` | `VARCHAR(50)` | 唯一、非空 | 课程代码（如“CS101”，教务系统统一编码） |
| `name` | `VARCHAR(100)` | 非空 | 课程名称（如“计算机基础”） |
| `teacher` | `VARCHAR(50)` | 非空 | 授课教师姓名 |
| `semester` | `VARCHAR(20)` | 非空 | 开课学期（如“2024-2025-1”） |

#### 索引说明
- `idx_course_code`：针对课程代码建立索引，优化课程代码查询效率；
- `idx_semester`：针对学期建立索引，优化按学期筛选课程的效率。

### 4. 作业表（`assignments`）
#### 功能描述
存储教师发布的课程作业信息，关联对应课程。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `assignment_id` | `INT` | 主键、自增 | 作业唯一ID |
| `course_id` | `INT` | 非空、外键 | 关联课程表`course_id`，课程删除时作业同步删除 |
| `title` | `VARCHAR(200)` | 非空 | 作业标题（如“第一章课后习题”） |
| `description` | `TEXT` | 无 | 作业详细要求 |
| `attachment_url` | `VARCHAR(255)` | 无 | 作业附件链接（如习题文档） |
| `deadline` | `DATETIME` | 无 | 作业提交截止时间 |
| `created_at` | `DATETIME` | 默认当前时间 | 作业发布时间 |

#### 索引说明
- `idx_course_id`：针对课程ID建立索引，优化按课程查询作业的效率；
- `idx_deadline`：针对截止时间建立索引，优化查询待提交/逾期作业的效率。

### 5. 作业提交表（`submissions`）
#### 功能描述
存储学生提交的作业信息，关联对应作业和用户，记录成绩与反馈。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `submission_id` | `INT` | 主键、自增 | 作业提交记录唯一ID |
| `assignment_id` | `INT` | 非空、外键 | 关联作业表`assignment_id`，作业删除时提交记录同步删除 |
| `user_id` | `INT` | 非空、外键 | 关联用户表`user_id`，用户删除时提交记录同步删除 |
| `file_url` | `VARCHAR(255)` | 非空 | 学生提交作业的文件链接 |
| `submitted_at` | `DATETIME` | 默认当前时间 | 作业提交时间 |
| `score` | `FLOAT` | 无 | 作业成绩（教师评分后填充） |
| `feedback` | `TEXT` | 无 | 教师对作业的评语反馈 |

#### 索引说明
- `idx_assignment_id`：针对作业ID建立索引，优化按作业查询提交记录的效率；
- `idx_user_id`：针对用户ID建立索引，优化按用户查询提交记录的效率。

### 6. 帖子表（`posts`）
#### 功能描述
存储校园论坛用户发布的帖子信息，支撑校园交流业务。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `post_id` | `INT` | 主键、自增 | 帖子唯一ID |
| `user_id` | `INT` | 非空、外键 | 关联用户表`user_id`，用户删除时帖子同步删除 |
| `title` | `VARCHAR(200)` | 非空 | 帖子标题 |
| `content` | `TEXT` | 非空 | 帖子正文内容 |
| `category` | `VARCHAR(50)` | 默认“校园” | 帖子分类（如“闲置交易”、“学习交流”、“校园资讯”） |
| `like_count` | `INT` | 默认`0` | 帖子点赞数 |
| `view_count` | `INT` | 默认`0` | 帖子浏览数 |
| `created_at` | `DATETIME` | 默认当前时间 | 帖子发布时间 |
| `updated_at` | `DATETIME` | 默认当前时间、更新时自动刷新 | 帖子最后修改时间（如编辑帖子后更新） |

#### 索引说明
- `idx_user_id_posts`：针对用户ID建立索引，优化按用户查询帖子的效率；
- `idx_category`：针对分类建立索引，优化按分类筛选帖子的效率；
- `idx_created_at`：针对发布时间建立索引，优化按时间排序查询帖子的效率。

### 7. 评论表（`comments`）
#### 功能描述
存储用户对帖子的评论信息，支持楼中楼（父子评论）功能。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `comment_id` | `INT` | 主键、自增 | 评论唯一ID |
| `post_id` | `INT` | 非空、外键 | 关联帖子表`post_id`，帖子删除时评论同步删除 |
| `user_id` | `INT` | 非空、外键 | 关联用户表`user_id`，用户删除时评论同步删除 |
| `content` | `TEXT` | 非空 | 评论内容 |
| `parent_id` | `INT` | 外键、默认`NULL` | 关联评论表`comment_id`，父评论删除时子评论同步删除；`NULL`表示一级评论 |
| `created_at` | `DATETIME` | 默认当前时间 | 评论发布时间 |

#### 索引说明
- `idx_post_id`：针对帖子ID建立索引，优化按帖子查询评论的效率；
- `idx_parent_id`：针对父评论ID建立索引，优化查询楼中楼评论的效率。

### 8. 通知表（`notifications`，可选）
#### 功能描述
存储平台向用户推送的各类通知信息，支撑消息提醒业务。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `notification_id` | `INT` | 主键、自增 | 通知唯一ID |
| `user_id` | `INT` | 非空、外键 | 关联用户表`user_id`，用户删除时通知同步删除 |
| `title` | `VARCHAR(200)` | 非空 | 通知标题（如“作业截止提醒”、“评论回复通知”） |
| `content` | `TEXT` | 无 | 通知详细内容 |
| `type` | `VARCHAR(50)` | 无 | 通知类型（如“assignment_deadline”、“comment_reply”、“system_notice”） |
| `is_read` | `BOOLEAN` | 默认`FALSE` | 通知阅读状态（`FALSE`未读，`TRUE`已读） |
| `related_url` | `VARCHAR(255)` | 无 | 通知关联链接（点击通知跳转至对应页面，如作业详情、帖子评论） |
| `created_at` | `DATETIME` | 默认当前时间 | 通知创建时间 |

#### 索引说明
- `idx_user_id_notifications`：针对用户ID建立索引，优化按用户查询通知的效率；
- `idx_is_read`：针对阅读状态建立索引，优化查询未读通知的效率。

### 9. 文件表（`files`，可选）
#### 功能描述
统一存储平台用户上传的各类文件（如作业附件、帖子图片等），便于文件管理与追溯。

#### 字段说明
| 字段名 | 字段类型 | 约束 | 备注 |
| ---- | ---- | ---- | ---- |
| `file_id` | `INT` | 主键、自增 | 文件唯一ID |
| `user_id` | `INT` | 非空、外键 | 关联用户表`user_id`，用户删除时文件记录同步删除 |
| `file_name` | `VARCHAR(255)` | 非空 | 原始文件名（如“第一章习题.docx”） |
| `file_url` | `VARCHAR(255)` | 非空 | 文件存储链接（本地路径或云存储地址） |
| `file_size` | `INT` | 无 | 文件大小（单位：字节） |
| `mime_type` | `VARCHAR(100)` | 无 | 文件MIME类型（如“application/pdf”、“image/jpg”） |
| `created_at` | `DATETIME` | 默认当前时间 | 文件上传时间 |

#### 索引说明
- `idx_user_id_files`：针对用户ID建立索引，优化按用户查询上传文件的效率。

## 三、表间关联关系
1.  核心关联：`users`（用户表）是核心关联表，与`submissions`、`posts`、`comments`、`notifications`、`files`均为**一对多**关系（一个用户可提交多个作业、发布多个帖子/评论/文件、接收多个通知）；
2.  课程与作业：`courses`（课程表）与`assignments`（作业表）为**一对多**关系（一门课程可发布多个作业）；
3.  作业与提交：`assignments`（作业表）与`submissions`（作业提交表）为**一对多**关系（一个作业可被多个用户提交，一个用户对一个作业仅一条提交记录）；
4.  帖子与评论：`posts`（帖子表）与`comments`（评论表）为**一对多**关系（一个帖子可有多条评论）；
5.  评论自关联：`comments`（评论表）通过`parent_id`实现自关联，为**一对多**关系（一条父评论可有多条子评论，即楼中楼功能）。

## 四、使用说明
1.  执行顺序：先执行数据库创建语句，再依次执行各表创建语句与索引创建语句；
2.  环境要求：支持`InnoDB`存储引擎的MySQL 5.7及以上版本（推荐MySQL 8.0）；
3.  加密建议：`users`表的`password`字段需通过BCrypt、SHA256等加密算法处理后存储，禁止明文存储；
4.  扩展建议：可根据实际业务需求，新增字段（如用户性别、课程学分）或表（如班级表、权限表）；
5.  维护建议：定期清理无效数据（如已删除用户的冗余文件记录），优化索引性能。

## 五、数据操作示例（可选）
### 1. 插入测试用户
```sql
INSERT INTO users (student_id, password, name, email, phone)
VALUES ('20240001', '$2a$10$xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', '张三', 'zhangsan@example.com', '13800138000');